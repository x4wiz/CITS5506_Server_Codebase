{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block head %}
	{{ super() }}
	<style type="text/css">
      .important {
          color: #336699;
      }
	</style>
{% endblock %}
{% block content %}
	<div class="container mx-auto px-4 flex justify-center">
		<div class="m-4 p-6 shadow rounded bg-gray-50">

			<h1 class="text-5xl">Air quality monitor</h1>
			<p class="important">
				Here's some sensor readings from my device

			<div>
				<p id="temperature_c"></p>
				<p id="humidity"></p>
				<p id="reading_date"></p>
				<p id="reading_time"></p>
			</div>

			<button type="button" onclick="get_data()" class="border-2 p-2
			m-2 hover:bg-gray-50 text-xl">Update
			                              data
			</button>
			<button onclick="live_data()"
			        class="border-2 p-2
			m-2  hover:bg-gray-50 text-xl">
				Constant update
			</button>
			<br>
			<div>
				<label for="readings_interval">Set readings interval in
				                               seconds</label><br>
				<input class="border-2 p-2
			m-2 hover:bg-gray-50 text-xl" type="number" min="3"
				       id="readings_interval"><br>
				<button onclick="set_interval()" class="border-2 p-2
			m-2 text-xl hover:bg-gray-50">Set interval
				</button>
			</div>
		</div>
	</div>



	<script>
      base_path = 'https://smart-air-quality.herokuapp.com/api/v1' //remote
      {#base_path = 'http://192.168.1.122:5000/api/v1' //local#}
      live_update_on = true

      const set_interval = () => {
          let interval = document.getElementById("readings_interval").value
          $.ajax({
              url: `${base_path}/set_readings_interval`,
              type: "POST",
              contentType: "application/json",
              data: JSON.stringify({
                  interval
              })
          })
          console.log(interval)
      }

      const live_data = () => {
          if (live_update_on) {
              setInterval(get_data, 1000 * 5)
          }

      }

      const get_data = async () => {
          $.ajax({
              url: `${base_path}/get_readings`,
              type: "GET",
              contentType: "application/json",
          }).done(data => {

		          let data_arr = data.split(" ")
		          console.log(data_arr)
              document.getElementById("temperature_c").innerText = data_arr[0]
		          document.getElementById("humidity").innerText = data_arr[1]
		          document.getElementById("reading_date").innerText =
				          data_arr[4] + " " + data_arr[3] + " " + data_arr[6]
		          document.getElementById("reading_date").innerText = data_arr[5]


          });
      }
	</script>

	{#	<script src="{{ url_for('static', filename='js/get_data.js') }}"></script>#}
{% endblock %}